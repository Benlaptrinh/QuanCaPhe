<div th:fragment="content">
    <h2>Thống kê - báo cáo</h2>
  
    <div th:if="${error}" style="color:red">
      <p th:text="${error}"></p>
    </div>
  
    <form th:action="@{/admin/report}" method="post" th:object="${filter}">
      <fieldset style="margin-bottom:8px;">
        <legend>Loại báo cáo</legend>
        <label>
          <input type="radio" th:field="*{type}" value="FINANCE"> Thu – Chi
        </label>
        <label style="margin-left:10px;">
          <input type="radio" th:field="*{type}" value="SALES"> Bán hàng
        </label>
        <label style="margin-left:10px;">
          <input type="radio" th:field="*{type}" value="STAFF"> Nhân viên
        </label>
      </fieldset>
      <div>
        <label>Từ ngày:</label>
        <input type="date" th:field="*{fromDate}" required>
      </div>
      <div>
        <label>Đến ngày:</label>
        <input type="date" th:field="*{toDate}" required>
      </div>
      <button type="submit">Xem</button>
      <button type="button" onclick="window.print()" class="no-print" style="margin-left:8px;">In</button>
    </form>
  
    <!-- TABLE (Thu - Chi) -->
    <div th:if="${filter.type == 'FINANCE'}">
      <table border="1" cellpadding="8" cellspacing="0" style="width:600px;"
             th:if="${reportData != null and !reportData.isEmpty()}">
      <thead>
        <tr>
          <th>Ngày</th>
          <th>Thu</th>
          <th>Chi</th>
        </tr>
      </thead>
  
      <tbody>
        <tr th:each="row : ${reportData}">
          <td th:text="${#temporals.format(row.ngay,'dd/MM')}"></td>
          <td th:text="${#numbers.formatDecimal(row.thu,0,'COMMA',0,'POINT')}"></td>
          <td th:text="${#numbers.formatDecimal(row.chi,0,'COMMA',0,'POINT')}"></td>
        </tr>
      </tbody>
  
      <tfoot>
        <tr>
          <th>Tổng</th>
          <th th:text="${#numbers.formatDecimal(#aggregates.sum(reportData.![thu]),0,'COMMA',0,'POINT')}"></th>
          <th th:text="${#numbers.formatDecimal(#aggregates.sum(reportData.![chi]),0,'COMMA',0,'POINT')}"></th>
        </tr>
      </tfoot>
      </table>

      <p th:if="${reportData == null or reportData.isEmpty()}">
        Chưa có dữ liệu
      </p>
    </div>

    <!-- SALES BY DAY -->
    <div th:if="${filter.type == 'SALES'}">
      <h3 style="margin-top:24px;">Bán hàng theo ngày</h3>
      <table border="1" cellpadding="8" cellspacing="0" style="width:600px;"
             th:if="${salesByDay != null and !salesByDay.isEmpty()}">
      <thead>
        <tr>
          <th>Ngày</th>
          <th>Số hóa đơn</th>
          <th>Doanh thu</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="r : ${salesByDay}">
          <td th:text="${#temporals.format(r.ngay,'dd/MM')}"></td>
          <td th:text="${r.soHoaDon}"></td>
          <td th:text="${#numbers.formatDecimal(r.doanhThu,0,'COMMA',0,'POINT')}"></td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <th>Tổng</th>
          <th th:text="${#aggregates.sum(salesByDay.![soHoaDon])}"></th>
          <th th:text="${#numbers.formatDecimal(#aggregates.sum(salesByDay.![doanhThu]),0,'COMMA',0,'POINT')}"></th>
        </tr>
      </tfoot>
      </table>

      <p th:if="${salesByDay == null or salesByDay.isEmpty()}">
        Chưa có dữ liệu bán hàng
      </p>
    </div>


    <!-- STAFF REPORT -->
    <div th:if="${filter.type == 'STAFF'}">
      <h3 style="margin-top:24px;">Báo cáo nhân viên</h3>
      <table border="1" cellpadding="8" cellspacing="0" style="width:400px;"
             th:if="${staffReport != null and !staffReport.isEmpty()}">
      <thead>
        <tr>
          <th>Trạng thái</th>
          <th>Số lượng</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="r : ${staffReport}">
          <td th:text="${r.trangThai}"></td>
          <td th:text="${r.soLuong}"></td>
        </tr>
      </tbody>
      </table>

      <p th:if="${staffReport == null or staffReport.isEmpty()}">
        Chưa có dữ liệu nhân viên
      </p>
    </div>
  </div>
  